# 📊 PHP Perfect Server Monitor (终极版)

这是一个轻量级、单文件的服务器硬件监控面板。它通过 PHP 调用底层 Linux 命令，直接读取 CPU、内存、硬盘、网络和温度传感器数据，并在网页上实时呈现。

## ⚠️ 核心要求 (必读)

为了让脚本正常工作，**必须**在 PHP 配置中允许执行系统命令。

### 1. 解除 PHP 函数禁用 (关键步骤)
大多数面板（如宝塔、1Panel）默认禁用了高危函数。你必须**删除**以下禁用项：

* **需要解禁的函数**：`shell_exec`
    * *(部分环境可能还需要 `exec` 或 `passthru`，但本脚本核心依赖 `shell_exec`)*

#### 🛠️ 宝塔面板操作指南：
1.  进入 **【软件商店】** -> **【已安装】**。
2.  找到你网站使用的 **PHP 版本** (例如 PHP 7.4 或 8.1)，点击 **【设置】**。
3.  点击左侧菜单的 **【禁用函数】**。
4.  在列表中找到 `shell_exec`，点击右侧的 **【删除】**。
5.  **重要：** 点击左侧菜单的 **【服务】** -> **【重启】** PHP 服务。

---

### 2. 安装必要传感器工具
脚本依赖 Linux 系统工具来读取硬件信息。如果是 Debian/Ubuntu 系统（包括 PVE），请确保安装了以下工具：

```bash
# 更新源
apt-get update

# 安装传感器工具 (用于读取温度)
apt-get install lm-sensors -y

# 探测传感器 (一路回车按 YES 即可)
sensors-detect
(注意：如果是虚拟机或某些精简版系统，lsblk 和 free 通常自带，无需额外安装。)

🚀 安装与使用
上传文件： 将 dashboard.php (或者你命名的文件名) 上传到网站根目录。

访问页面： 浏览器访问 http://你的IP或域名/dashboard.php。

配置开机自启 (可选)： 本脚本是网页，只要 Web 服务器 (Nginx/Apache) 和 PHP 在运行，它就能工作，无需专门配置自启。

❓ 常见问题排查
Q: 网页能打开，但所有数据都是 0 或显示 Loading...？

A: 检查 PHP 的 shell_exec 函数是否已解禁并重启了 PHP 服务。

A: 检查宝塔网站设置中的“防跨站攻击 (open_basedir)”是否开启。如果开启，PHP 无法读取 /proc 目录。请在 【网站设置】->【网站目录】 中取消勾选防跨站攻击。

Q: 温度显示不全或没有温度？

A: 运行 sensors 命令看终端是否有输出。如果是 PVE 虚拟机，某些宿主机可能不会把温度传感器透传给虚拟机。

A: 本脚本已针对 Xeon E3 和 NVMe 做了正则匹配，如果是其他特殊 CPU，可能需要微调正则表达式。

Q: 硬盘显示不全？

A: 脚本通过 lsblk 读取物理盘。如果你的硬盘是直通的 (Passthrough)，应该能看到真实型号；如果是虚拟磁盘 (Virtual Disk)，可能只显示 QEMU/Virtual Disk。

🔒 安全建议
由于开启了 shell_exec，该脚本具有执行系统命令的权限。

不要在公网裸奔：建议不要直接将此页面暴露在未加密、无密码的公网环境。

加把锁：建议在 Nginx/Apache 配置中为该文件添加 基本认证 (密码访问)，或者配合宝塔的“访问限制”功能使用。

内网使用：如果是像你一样的家庭内网环境 (HomeLab)，通常是安全的。


***

### 重点总结：

下次你换新设备部署时，只要做两件事：
1.  `apt install lm-sensors`
2.  在宝塔里把 `shell_exec` 从禁用列表里**删掉**。

搞定这两步，脚本放进去就能跑。
